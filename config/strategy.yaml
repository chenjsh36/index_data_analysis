# 策略配置：按策略名分组，RSI 参数与风控
# v2 回测配置见 backtest 段；策略级参数见 strategies.<name>

# ---------------------------------------------------------------------------
# 回测专用配置（全局，仅影响 run_backtest；见 docs/v2/04-technical-design.md）
# ---------------------------------------------------------------------------
backtest:
  # 是否在每根 K 线检查止损/止盈触达并平仓（false=关闭，与 nasdaq_v1 等日频指数回测主流一致）
  use_stop_loss_take_profit: false
  # T 日信号 → T+1 日执行（次日执行），与 use_stop_loss_take_profit 同时使用更贴近指数日频回测
  next_day_execution: true
  # 是否启用趋势破位止损：收盘价跌破/站上 50 日均线时平仓
  use_ma50_exit: false
  # 回撤熔断：累计回撤超阈值时平仓并暂停开仓
  circuit_breaker:
    enabled: false
    drawdown_threshold: 0.10   # 触发熔断的回撤比例，如 0.10 表示 10%
    position_after: 0.30      # 熔断后允许的最大仓位比例（当前实现为平仓后 cooldown）
    cooldown_bars: 2          # 熔断后禁止新开仓的 K 线数量
  # 绩效指标计算
  metrics:
    risk_free_rate: 0.00      # 夏普比率计算用无风险利率（年化），如 0.02 表示 2%
    accrue_risk_free_when_flat: false  # 空仓时权益按无风险利率日复利，更贴近实际资金增值（见 docs/v4/06-backtest-cash-risk-free-accrual.md）
  commission: 0               # 单边手续费比例，0=无手续费（当前回测设为 0）

# ---------------------------------------------------------------------------
# 策略定义：strategies.<策略名> 下为各策略参数（当前仅保留 EMA_trend_v2）
# ---------------------------------------------------------------------------
strategies:
  EMA_trend_v2:
    index_code: "QQQ"
    ema_fast: 80
    ema_slow: 200
    vol_window: 20
    vol_threshold: 0.02
    risk_control:
      stop_loss_ratio: 0.05
      take_profit_ratio: 0.20

  EMA_trend_v3:
    index_code: "QQQ"
    ema_fast: 80
    ema_slow: 200
    adx_period: 14
    adx_threshold: 25
    macd_fast: 12
    macd_slow: 26
    macd_signal: 9
    vol_window: 20
    vol_threshold: 0.02
    use_vol_filter: false
    vix_threshold: 25
    risk_control:
      stop_loss_ratio: 0.05
      take_profit_ratio: 0.20

  NDX_MA50_Volume_RSI:
    index_code: "QQQ"
    rsi_period: 14
    vol_ratio_heavy: 1.2
    vol_ratio_light: 0.8
    slope_flat_threshold: 0.1    # 震荡：连续5日斜率绝对值 < 0.1%（单位：百分比数值，0.1 即 0.1%）
    oscillate_range: 0.03        # 震荡：收盘在 SMA50 ±3%
    risk_control:
      stop_loss_ratio: 0.05
      take_profit_ratio: 0.20