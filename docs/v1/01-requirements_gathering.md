# 需求梳理文档（Requirements Gathering）

**文档版本**：v1  
**产出日期**：2026-02-08  
**依据**：研发流程步骤 1 - 需求梳理  
**参考规范**：IEEE 830-1998 SRS、BABOK、User Story (INVEST)、5W1H、MoSCoW

---

## 一、5W1H 分析

| 维度 | 说明 |
|------|------|
| **Who（谁）** | 纳斯达克100（NDX/QQQ/TQQQ）短线波段交易者；系统开发者/维护者；数据提供方（如 Yahoo Finance）。 |
| **What（做什么）** | 构建一套 **RSI 量化分析与交易信号系统**，将 BRD 中的「定性 RSI 实操规则」转化为可执行的量化逻辑，实现「50日均线定趋势 + 成交量验真假 + RSI 找点位」的闭环，并支持回测、监控与信号输出。 |
| **When（何时）** | 短线波段持仓周期 3–10 天；日线为主决策，30 分钟线辅助择时；排除极端行情（如 VIX>30 且 RSI<10 或 RSI>90）下的逆势操作。 |
| **Where（在哪）** | 纳斯达克100 及相关标的（QQQ、TQQQ）；数据与计算可本地/云端部署；未来可扩展至标普500、道指等指数。 |
| **Why（为什么）** | 将文档化、经验化的 RSI 实战规则系统化、可验证化，过滤约 80% 假信号，提升决策一致性与可复现性；目标胜率≥62%、盈亏比≥1.5、最大回撤≤15%。 |
| **How（怎么做）** | 分层架构：数据层 → 计算层 → 信号层 → 策略层 → 回测/风控/监控；核心指标手写实现并用开源库（如 TA-Lib）验证；策略与参数配置化（如 YAML），支持多指数/多周期扩展。 |

---

## 二、利益相关者与用户角色

| 角色 | 描述 | 关注点 |
|------|------|--------|
| **交易者（主用户）** | 使用 NDX/QQQ/TQQQ 进行 3–10 天短线波段交易 | 信号准确性、假信号过滤、仓位与止损止盈建议、回测结果可信度 |
| **策略/量化开发** | 实现与维护策略逻辑、指标与回测 | 规则可配置、指标可验证、架构可扩展、代码可维护 |
| **运维/监控** | 保障数据与任务稳定、告警 | 数据完整性、延迟、异常告警、系统可用性 |
| **数据提供方** | 行情与衍生数据（如 VIX） | 接口稳定、字段与频率满足计算与回测需求 |

---

## 三、需求清单（Requirements List）

### 3.1 功能需求（Functional Requirements）

| ID | 需求描述 | 优先级 (MoSCoW) | 来源 |
|----|----------|-----------------|------|
| FR-01 | 支持从指定数据源获取 NDX/QQQ/TQQQ 的日线、30 分钟线行情（开高低收、成交量），以及前复权处理 | Must | BRD, design, tech_v1 |
| FR-02 | 支持 50 日均线（收盘价）、9/24 日 RSI、20 日均量及「当日量/20 日均量」比值计算 | Must | design, tech_v1/v2 |
| FR-03 | 根据 50 日均线趋势与价格波动识别市场环境（牛市/熊市/震荡市），并动态调整 RSI 超买超卖阈值 | Must | BRD, design, tech_v1 |
| FR-04 | 识别超买超卖、顶/底背离、金叉/死叉等核心 RSI 信号，并叠加趋势与量能验证以过滤假信号 | Must | BRD, design, tech_v1 |
| FR-05 | 输出买入/卖出/观望等信号，并给出建议仓位、止损位、止盈位 | Must | design, tech_v1 |
| FR-06 | 支持 2018–2025 年历史回测，按策略规则执行并统计胜率、盈亏比、最大回撤、夏普等指标 | Must | design, tech_v1 |
| FR-07 | 核心指标（RSI、均线、量能比）具备手写实现，并与开源库（如 TA-Lib）结果比对，偏差在约定范围内（如 RSI≤0.1） | Should | tech_v2 |
| FR-08 | 策略与参数（RSI 周期、阈值、仓位、止损止盈）通过配置文件（如 YAML）管理，无需改代码即可调参 | Should | tech_v2 |
| FR-09 | 预留多指数、多周期扩展：统一数据源与策略接口，新增标的/周期时以配置与少量实现为主 | Could | tech_v2 |
| FR-10 | 实时或近实时监控：数据更新后生成信号，支持告警（如钉钉/邮件）；可选可视化面板展示趋势、RSI、量能、持仓与信号 | Could | design, tech_v1 |
| FR-11 | 极端行情保护：VIX>30 且 RSI<10 或 RSI>90 时禁止新开仓；回撤超阈值时降仓或暂停 | Must | design, tech_v1 |

### 3.2 非功能需求（Non-Functional Requirements）

| ID | 需求描述 | 类型 | 验收参考 |
|----|----------|------|----------|
| NFR-01 | RSI 等核心指标与权威来源（如 TradingView）或 TA-Lib 偏差≤0.5（对外）或手写与库≤0.1（内部验证） | 正确性 | tech_v1/v2 |
| NFR-02 | 回测胜率≥62%（短线）、盈亏比≥1.5、最大回撤≤15%（或≤20% 放宽版） | 策略绩效 | BRD, design, tech_v1 |
| NFR-03 | 日线信号在数据就绪后一定时间内产出（如 5 分钟内）；分钟级信号延迟≤1 分钟 | 实时性 | tech_v1 |
| NFR-04 | 数据缺失或异常时能识别并限流/暂停信号输出，不误触发 | 稳定性/安全 | design, tech_v1 |
| NFR-05 | 分层与接口清晰，指标与策略可单独测试；新增指数/周期时代码改动可控（如≤200 行+配置） | 可维护性/可扩展性 | tech_v2 |
| NFR-06 | 关键指标与策略逻辑有单元测试，覆盖率≥90%（与验证流程配套） | 可测试性 | tech_v2 |

---

## 四、用户故事（User Stories，INVEST）

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-01 | 作为交易者，我希望系统根据最新行情计算 9/24 日 RSI 与 50 日均线，以便我判断当前趋势与超买超卖状态 | 给定日线数据，能输出与约定算法一致的 RSI 与 MA50，且可通过 TA-Lib 等验证 |
| US-02 | 作为交易者，我希望在满足「趋势+量能+RSI」条件时收到明确的买入/卖出建议及仓位与止损止盈，以便执行短线波段 | 信号类型、仓位比例、止损止盈符合设计文档规则，且回测达标 |
| US-03 | 作为交易者，我希望在极端行情（如 VIX>30 且 RSI 极值）时不被建议开新仓，以便控制风险 | 满足条件时系统不输出开仓类信号 |
| US-04 | 作为策略开发，我希望通过改配置文件即可调整 RSI 周期与超买超卖阈值，以便快速做参数试验 | 修改 YAML 等配置后，无需改代码即可生效（或仅需重启/重载） |
| US-05 | 作为策略开发，我希望对 NDX 短线策略做 2018–2025 回测并查看胜率、回撤、夏普等，以便评估策略 | 回测产出标准指标报表，且与设计中的绩效目标可对照 |
| US-06 | 作为运维，我希望在数据缺失或延迟超限时收到告警并暂停信号，以便避免错误决策 | 有明确的数据质量检查与告警/熔断逻辑 |

---

## 五、用例摘要（Use Cases）

| 用例 | 参与者 | 主要流程 | 后置条件 |
|------|--------|----------|----------|
| 计算并验证 RSI | 系统/开发 | 获取收盘价 → 手写 RSI 计算 → 与 TA-Lib 比对 → 记录偏差 | 偏差在阈值内，结果可用于信号层 |
| 识别市场环境并选阈值 | 系统 | 计算 50 日均线及斜率、价格与均线关系 → 判定牛/熊/震荡 → 选择对应 RSI 阈值 | 当前环境与阈值被策略层使用 |
| 生成交易信号 | 系统 | 趋势判定 → 量能验证 → RSI 信号（超买超卖/背离/金叉死叉）→ 组合过滤 → 输出信号+仓位+止损止盈 | 信号与风控参数可供执行或回测 |
| 执行历史回测 | 策略开发 | 加载历史数据 → 按日推进 → 应用策略与风控 → 统计绩效 | 得到胜率、盈亏比、回撤、夏普等 |
| 监控与告警 | 运维/系统 | 定时拉取最新数据 → 计算指标与信号 → 异常或信号触发时告警 | 告警送达，必要时暂停信号 |

---

## 六、约束与风险

### 6.1 约束条件

- **数据依赖**：依赖外部行情与 VIX 等数据源可用性与格式稳定；缺失或延迟会影响信号与回测。
- **合规与实盘**：当前范围以「分析与信号」为主；若接券商/实盘执行，需单独考虑合规与授权。
- **交易风格边界**：首版聚焦 NDX 短线（3–10 天），其他周期/指数为扩展项。

### 6.2 风险识别

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 数据源变更或停服 | 无法更新行情，回测与实盘信号中断 | 抽象数据源接口，支持多数据源；文档化数据要求与备用源 |
| 规则过拟合历史 | 回测好看、实盘表现差 | 参数敏感性测试、多区间验证、保守阈值 |
| 极端行情规则不全 | 非常态下产生不当信号 | 明确极端行情定义并禁止逆势开仓；回撤熔断 |
| 指标实现与文档不一致 | 信号与 BRD/设计不符 | 手写+库验证、单测与回测用例、代码与文档对齐 |

---

## 七、需求确认检查点

完成本步骤后，请确认：

1. ✅ 是否遵循了需求梳理的业界规范（5W1H、MoSCoW、User Story/用例、利益相关者）？
2. ✅ 是否已产出需求清单、用户故事与用例摘要？
3. ✅ 功能需求是否覆盖数据、计算、信号、策略、回测、风控与扩展？
4. ✅ 非功能需求是否覆盖正确性、绩效目标、实时性、稳定性、可维护性与可测试性？
5. ✅ 约束与风险是否已识别并有缓解思路？
6. ✅ 是否与背景（BRD）、设计思路（design）、技术方案（tech_v1/v2）一致，且 product_form 为空时已从设计/技术方案推断产品形态？

**产品形态归纳（因 product_form.md 为空）**：  
本系统为一套 **纳斯达克100 RSI 量化分析与交易信号系统**，形态为「数据+计算+信号+策略+回测+风控」的后端服务，可选监控与可视化；首版以 NDX 短线（3–10 天）为核心，后续可通过配置与接口扩展多指数、多周期。

---

## 八、文档与版本

| 文档 | 路径 | 说明 |
|------|------|------|
| 背景/业务规则 | `index_data_analysis/docs/context/brd.md` | RSI 理论、NDX 实操、50 日均线+成交量+RSI 配合 |
| 产品形态 | `index_data_analysis/docs/context/product_form.md` | 当前为空，由设计与技术方案推断 |
| 设计思路 | `index_data_analysis/docs/context/design.md` | 数据/规则/信号/回测/风控/监控/迭代设计 |
| 技术方案 v1 | `index_data_analysis/docs/context/tech_v1.md` | 分层架构、数据/计算/信号/策略/回测/风控/部署 |
| 技术方案 v2 | `index_data_analysis/docs/context/tech_v2.md` | 手写+验证、多指数多周期、配置化与接口抽象 |

---

**下一步**：本步骤完成后，请确认需求理解是否一致；确认后将进入「步骤 2：需求文档」的编写。
