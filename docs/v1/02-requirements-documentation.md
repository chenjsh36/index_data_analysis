# 需求规格说明书（SRS / PRD）

**文档编号**：SRS-NDX-RSI-v1  
**文档版本**：1.0  
**产出日期**：2026-02-08  
**依据**：研发流程步骤 2 - 需求文档  
**参考规范**：IEEE 830-1998、ISO/IEC/IEEE 29148、FURPS+、需求可追溯性矩阵（RTM）  
**上游输入**：`01-requirements_gathering.md`

---

## 1. 项目概述

### 1.1 背景

纳斯达克100 指数（NDX）及关联标的（QQQ、TQQQ）的短线波段交易中，RSI（相对强弱指数）结合 50 日均线与成交量的判断方法在业务文档（BRD）中已形成一套定性实操规则。为提升决策一致性、可复现性与可验证性，需将上述规则转化为可执行的量化逻辑，并支持回测、监控与信号输出。

### 1.2 目标

- 构建 **NDX RSI 量化分析与交易信号系统**，实现「50 日均线定趋势 + 成交量验真假 + RSI 找点位」的闭环。
- 过滤约 80% 的 RSI 假信号，目标绩效：胜率≥62%、盈亏比≥1.5、最大回撤≤15%（或放宽至≤20%）。
- 支持历史回测、近实时信号生成与可选监控告警；架构上预留多指数、多周期扩展能力。

### 1.3 范围

| 维度 | 范围内 | 范围外 |
|------|--------|--------|
| 标的 | NDX / QQQ / TQQQ（首版） | 标普500、道指等（预留扩展） |
| 交易风格 | 短线波段（3–10 天），日线主决策 + 30 分钟辅助 | 日内超短线、长线持仓（首版不做） |
| 功能 | 数据获取与预处理、指标计算、信号生成、回测、风控、配置化、可选监控 | 实盘自动下单、券商对接（需单独合规） |
| 用户 | 交易者（信号与建议）、策略/量化开发、运维 | 合规与法务审批流程 |

---

## 2. 功能需求（详细描述）

以下功能需求与 `01-requirements_gathering.md` 中的 FR-xx 一一对应，并补充详细描述与验收标准。

### 2.1 数据获取与预处理（FR-01）

**描述**：系统从指定数据源获取纳斯达克100 及相关标的的行情数据，并完成必要预处理。

**详细要求**：

- **数据品种**：NDX（指数）、QQQ、TQQQ 等标的。
- **数据频率**：日线（主）、30 分钟线（辅助择时）。
- **字段**：开盘价、最高价、最低价、收盘价、成交量；可选复权因子。
- **预处理**：前复权处理，避免除权导致价格失真；剔除停牌、明显异常值；缺失值策略（如日线缺失超 2 个周期则标记异常并影响信号可用性）。

**验收标准**：

- 能按标的与时间范围拉取日线、30 分钟线数据。
- 输出数据包含所需 OHLCV 字段，且经过前复权与基本清洗。
- 数据源可配置（如通过配置切换 Yahoo Finance 等），接口抽象便于扩展其他数据源。

---

### 2.2 指标计算（FR-02）

**描述**：基于行情数据计算策略所需的全部技术指标。

**详细要求**：

- **50 日均线（MA50）**：基于收盘价的简单移动平均，窗口 50。
- **RSI**：支持多周期（首版至少 9 日、24 日），计算公式与 BRD/设计文档一致（SMA 涨幅/跌幅，RS = AvgU/AvgD，RSI = 100 - 100/(1+RS)）。
- **20 日均量**：成交量 20 日简单移动平均。
- **量能比**：当日成交量 / 近 20 日均量，用于「放量/缩量」判定（≥1.2 视为放量，≤0.8 视为缩量）。

**验收标准**：

- 给定相同输入，RSI、MA50、量能比与设计文档公式一致。
- RSI 与 TA-Lib（或约定权威源）结果偏差≤0.5（对外口径）；若实现手写+库双路径，手写与库偏差≤0.1（FR-07）。

---

### 2.3 市场环境识别与阈值动态调整（FR-03）

**描述**：根据 50 日均线趋势与价格波动特征，自动识别市场环境（牛市/熊市/震荡市），并选用对应的 RSI 超买超卖阈值。

**详细要求**：

- **趋势判定**：50 日均线斜率（如近 5 日或 20 日）及价格与均线关系（连续 2 日收盘价站上/跌破均线等），具体规则与设计文档一致。
- **环境标签**：bull（牛市单边）、bear（熊市单边）、oscillate（震荡）、transition（过渡期，可沿用前一周期）。
- **阈值表**：牛/熊/震荡对应不同 overbuy、strong_overbuy、oversell、strong_oversell 数值，与 BRD/设计文档中的 NDX 专属阈值一致。

**验收标准**：

- 对历史典型区间（如 2021 牛市、2022 熊市、2023 震荡）能正确输出对应环境标签。
- 阈值与配置或设计文档一致，且随环境切换正确应用。

---

### 2.4 核心 RSI 信号识别与假信号过滤（FR-04）

**描述**：识别超买超卖、顶/底背离、金叉/死叉等核心 RSI 信号，并叠加趋势与量能验证，过滤假信号。

**详细要求**：

- **超买超卖**：根据当前市场环境选用对应阈值，判断 RSI 是否进入超买/超卖区；并结合量能（缩量企稳/放量滞涨等）做有效性验证。
- **背离**：顶背离（价格创新高、RSI 未创新高）、底背离（价格创新低、RSI 未创新低）；可要求成交量等辅助条件；日线/周线级别优先。
- **金叉/死叉**：9 日 RSI 与 24 日 RSI 的交叉；有效金叉/死叉需满足交叉区间、量能、均线等条件（与设计文档规则一致）。
- **过滤原则**：趋势 > 量能 > RSI；上升趋势中可忽略单纯超买（除非缩量滞涨），下降趋势中可忽略单纯超卖（除非缩量企稳）。

**验收标准**：

- 信号类型与触发条件与设计文档、BRD 规则一致。
- 回测中假信号率控制在约定范围内（如≤20%），且与人工规则回溯可对照。

---

### 2.5 交易信号与风控参数输出（FR-05）

**描述**：在满足「趋势+量能+RSI」组合条件时，输出买卖建议及配套风控参数。

**详细要求**：

- **信号类型**：买入、卖出、观望、轻仓试多、轻仓试空等，与设计文档一致。
- **仓位建议**：按信号类型与市场环境给出建议仓位比例（如 30%、40%、50% 等），符合设计文档中的仓位表。
- **止损/止盈**：按标的类型（ETF/杠杆 ETF）与信号类型给出止损位、止盈位（比例或价格），与设计文档一致。
- **趋势破位止损**：如收盘价有效跌破/站上 50 日均线时的清仓或减仓规则。

**验收标准**：

- 每个输出信号均带有信号类型、建议仓位、止损、止盈（若适用）。
- 与设计文档中的信号层、风控层规则一致，并可在回测中复现。

---

### 2.6 历史回测（FR-06）

**描述**：在指定历史区间（首版至少支持 2018–2025）内，按策略与风控规则逐日推进，统计绩效指标。

**详细要求**：

- **回测周期**：可配置起止日期，默认覆盖 2018–2025（含牛熊震荡）。
- **标的**：至少支持 QQQ、TQQQ（或 NDX 代理）。
- **成本**：手续费、滑点可配置（如 0.05%/次）。
- **统计指标**：胜率、盈亏比、最大回撤、年化收益、夏普比率等；与设计文档中的绩效评估指标一致。

**验收标准**：

- 回测可重复运行并得到稳定结果。
- 输出报表包含上述核心指标；短线策略胜率≥62%、盈亏比≥1.5、最大回撤≤15%（或≤20% 放宽版）。

---

### 2.7 核心指标手写实现与验证（FR-07，Should）

**描述**：对 RSI、均线、量能比等核心指标提供手写实现，并与开源库（如 TA-Lib）结果比对，确保逻辑可解释、无黑盒。

**详细要求**：

- 手写实现需注释清晰，与 BRD 公式一致。
- 自动化验证：同一输入下手写结果与库结果偏差≤0.1（可配置）。
- 验证通过后纳入单测，覆盖率与 NFR-06 一致。

**验收标准**：

- 手写 RSI/均线/量能比与 TA-Lib（或约定库）偏差在阈值内。
- 有文档或单测记录验证结果。

---

### 2.8 策略与参数配置化（FR-08，Should）

**描述**：RSI 周期、超买超卖阈值、仓位规则、止损止盈比例等均通过配置文件（如 YAML）管理，修改后无需改代码即可生效（或仅需重启/重载）。

**详细要求**：

- 配置文件按「指数+周期」或「策略名称」分组。
- 包含：RSI 短/长周期、各市场环境下的阈值、风控参数（最大仓位、止损/止盈比例等）。

**验收标准**：

- 修改配置后，重新运行回测或信号生成能使用新参数。
- 文档说明配置项含义与可选范围。

---

### 2.9 多指数/多周期扩展预留（FR-09，Could）

**描述**：架构上通过统一数据源接口、策略抽象接口与配置驱动，预留多指数（如标普500、道指）、多周期（如中线 1–3 月）扩展能力。

**详细要求**：

- 数据源抽象：新数据源实现统一接口即可接入。
- 策略抽象：新策略实现统一接口并注册配置即可参与回测/监控。
- 新增一个指数或周期时，代码改动量可控（如≤200 行 + 配置）。

**验收标准**：

- 具备数据源与策略的抽象定义与至少一例实现。
- 文档描述扩展步骤（配置 + 实现类）。

---

### 2.10 监控与告警（FR-10，Could）

**描述**：在数据更新后生成信号，并在异常或信号触发时支持告警（如钉钉/邮件）；可选可视化面板展示趋势、RSI、量能、持仓与信号。

**详细要求**：

- 定时拉取最新数据、计算指标与信号。
- 告警条件可配置：如信号触发、数据缺失、延迟超限、回撤超阈值等。
- 可视化为可选；若实现，需展示当前趋势、RSI、量能、信号与建议仓位等。

**验收标准**：

- 告警渠道与触发条件可配置，且能在测试环境验证。
- 若有面板，核心信息与信号输出一致。

---

### 2.11 极端行情与回撤保护（FR-11）

**描述**：在极端行情或回撤超限时，禁止新开仓或强制降仓/暂停，避免逆势与风控失控。

**详细要求**：

- **极端行情**：VIX>30 且（RSI<10 或 RSI>90）时，禁止新开仓。
- **回撤熔断**：累计回撤≥约定阈值（如 10%）时，强制降仓至约定比例（如 30%）并暂停交易若干日（如 2 个交易日）。

**验收标准**：

- 满足上述条件时，系统不输出开仓类信号或执行降仓/暂停逻辑。
- 回测或模拟中可验证熔断行为。

---

## 3. 非功能需求

### 3.1 正确性（NFR-01）

- RSI 等核心指标与 TA-Lib 或约定权威源偏差≤0.5（对外）；手写与库偏差≤0.1（内部验证）。
- 信号逻辑与 BRD、设计文档一致，可通过回测与规则回溯验证。

### 3.2 策略绩效（NFR-02）

- 短线（3–10 天）回测：胜率≥62%，盈亏比≥1.5，最大回撤≤15%（目标）或≤20%（放宽）。
- 绩效指标定义与设计文档一致（年化、夏普等）。

### 3.3 实时性（NFR-03）

- 日线信号：在数据就绪后一定时间内（如 5 分钟内）产出。
- 分钟级信号：延迟≤1 分钟（若实现分钟级策略）。

### 3.4 稳定性与数据安全（NFR-04）

- 数据缺失或异常时能识别并限流/暂停信号输出，不误触发。
- 关键路径有异常处理与日志，便于排查。

### 3.5 可维护性与可扩展性（NFR-05）

- 分层与接口清晰，指标与策略可单独测试。
- 新增指数/周期时代码改动可控（如≤200 行 + 配置），符合 tech_v2 扩展设计。

### 3.6 可测试性（NFR-06）

- 关键指标与策略逻辑有单元测试，覆盖率≥90%（与验证流程配套）。
- 回测可重复、可自动化，并产出标准指标报表。

---

## 4. 约束条件

| 类型 | 约束内容 |
|------|----------|
| 数据 | 依赖外部行情与 VIX 等数据源；接口与字段需满足计算与回测需求；缺失或延迟会影响信号与回测可用性。 |
| 合规 | 当前范围以「分析与信号」为主；实盘下单或券商对接需单独合规与授权。 |
| 范围 | 首版聚焦 NDX 短线（3–10 天）；其他周期/指数为扩展项。 |
| 技术 | 指标与策略需与 BRD/设计文档一致；核心指标建议手写+库验证；架构需支持配置化与扩展。 |

---

## 5. 验收标准汇总（Acceptance Criteria）

以下为按需求条目的验收标准汇总，便于测试与验收。

| 需求 ID | 验收标准摘要 |
|---------|----------------|
| FR-01 | 能按标的与时间拉取日线/30 分钟线；数据含 OHLCV 且经前复权与清洗；数据源可配置、接口可扩展。 |
| FR-02 | RSI、MA50、20 日均量、量能比计算与文档一致；RSI 与库偏差在约定范围内。 |
| FR-03 | 典型历史区间环境标签正确；阈值随环境正确应用。 |
| FR-04 | 信号类型与触发条件与设计/BRD 一致；假信号率在约定范围内。 |
| FR-05 | 信号带类型、仓位、止损、止盈；与设计文档一致且回测可复现。 |
| FR-06 | 回测可重复、报表含胜率/盈亏比/回撤/夏普；短线达标（胜率≥62% 等）。 |
| FR-07 | 手写与库偏差≤0.1；有验证记录或单测。 |
| FR-08 | 配置修改后参数生效；配置项有文档说明。 |
| FR-09 | 存在数据源与策略抽象及扩展说明。 |
| FR-10 | 告警可配置并可验证；若有面板则与信号一致。 |
| FR-11 | 极端行情不开仓；回撤熔断行为可验证。 |
| NFR-01–06 | 见第 3 节非功能需求及上文各条。 |

---

## 6. 术语表（Glossary）

| 术语 | 英文 | 说明 |
|------|------|------|
| RSI | Relative Strength Index | 相对强弱指数，0–100 动量震荡指标，用于超买超卖与趋势辅助判断。 |
| NDX | Nasdaq-100 | 纳斯达克100 指数。 |
| QQQ | - | 跟踪纳斯达克100 的 ETF。 |
| TQQQ | - | 3 倍杠杆纳斯达克100 ETF。 |
| MA50 | 50-day Moving Average | 50 日均线（本需求中基于收盘价的简单移动平均）。 |
| 量能比 | Volume Ratio | 当日成交量 / 近 20 日均量，用于放量/缩量判定。 |
| 金叉 | Golden Cross | 短期 RSI 上穿长期 RSI，视为潜在买入信号。 |
| 死叉 | Death Cross | 短期 RSI 下穿长期 RSI，视为潜在卖出信号。 |
| 顶背离 | Bearish Divergence | 价格创新高而 RSI 未创新高，潜在见顶信号。 |
| 底背离 | Bullish Divergence | 价格创新低而 RSI 未创新低，潜在见底信号。 |
| VIX | CBOE Volatility Index | 恐慌指数，用于极端行情判断。 |
| 前复权 | Adjusted (split/dividend) | 按除权除息调整历史价格，使序列连续可比。 |

---

## 7. 需求可追溯性矩阵（RTM）

| 本 SRS 需求/章节 | 上游 01-requirements_gathering | 下游（可填步骤 3–6） |
|------------------|--------------------------------|----------------------|
| 2.1 数据（FR-01） | FR-01 | 技术栈、数据层设计 |
| 2.2 指标（FR-02） | FR-02 | 计算层设计、单测 |
| 2.3 市场环境（FR-03） | FR-03 | 规则层、配置 |
| 2.4 信号（FR-04） | FR-04 | 信号层、策略层 |
| 2.5 信号输出（FR-05） | FR-05 | 策略层、API/输出 |
| 2.6 回测（FR-06） | FR-06 | 回测层、验收 |
| 2.7 手写验证（FR-07） | FR-07 | 计算层、单测 |
| 2.8 配置化（FR-08） | FR-08 | 配置层、部署 |
| 2.9 扩展（FR-09） | FR-09 | 架构、接口 |
| 2.10 监控（FR-10） | FR-10 | 监控层、运维 |
| 2.11 风控（FR-11） | FR-11 | 风控层 |
| 第 3 节 非功能需求 | NFR-01–06 | 全栈、测试、运维 |

---

## 8. 需求变更日志

| 版本 | 日期 | 变更说明 | 作者/来源 |
|------|------|----------|-----------|
| 1.0 | 2026-02-08 | 初版，基于 01-requirements_gathering 编写完整 SRS/PRD | 步骤 2 产出 |

---

**下一步**：本步骤完成后，请确认需求文档内容是否准确；确认后将进入「步骤 3：技术栈选择」。
