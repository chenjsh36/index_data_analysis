# 需求梳理 (Requirements Gathering) — v6

基于 `brd.md` 的 BRD 内容，按研发流程步骤 1 进行需求梳理。  
**参考规范**: IEEE 830、BABOK、User Story (INVEST)、5W1H、MoSCoW。

---

## 1. 5W1H 概览

| 维度 | 说明 |
|------|------|
| **Who** | 使用/查看结果的利益相关者：自用或小团队、需接收每日信号与查看历史走势的用户 |
| **What** | ① 每日定时跑信号并推送结果；② 静态 Web 服务展示 QQQ 近 5 年走势与当日信号详情 |
| **When** | 每日定时（如收盘后）执行信号；页面随时可访问查看 |
| **Where** | 部署于 GitHub（含 Actions 等）；静态服务可同仓库或独立托管 |
| **Why** | 自动化信号产出与触达、集中查看历史与当日结论，减少手工跑命令与查数据 |
| **How** | 参考 daily_stock_analysis：定时任务 + 通知渠道；本项目内启动静态服务 + 图表与信号展示 |

---

## 2. 需求清单 (Requirements List)

### 2.1 功能需求 (Functional)

| ID | 需求描述 | 优先级 (MoSCoW) | 备注 |
|----|----------|-----------------|------|
| FR-1 | 项目部署到 GitHub 后，支持定时（如每天一次）自动执行“跑信号”命令 | Must | 参考 daily_stock_analysis 的定时与执行方式 |
| FR-2 | 将每日信号运行结果发送到指定渠道（如邮件、Slack、钉钉、Webhook 等，具体渠道可配置） | Must | 渠道与配置方式待与用户确认 |
| FR-3 | 在项目内或关联仓库中启动静态 Web 服务，通过浏览器访问页面 | Must | 静态服务即可，无需后端动态 API（若仅展示预生成数据） |
| FR-4 | 页面展示：获取最近 5 年纳斯达克 QQQ 指数数据，并以曲线走势图形式展示 | Must | 数据来源与更新频率需在技术方案中定（如每日更新） |
| FR-5 | 页面展示：当日运行信号后的结果，包含但不限于：收盘价、EMA、波动率、推导逻辑、操作建议等 | Must | 与现有 `run_signal` 输出内容对齐，可复用 report 逻辑 |
| FR-6 | 定时任务与静态服务可独立配置（如开关、执行时间、标的、渠道） | Should | 便于不同环境/用途 |

### 2.2 非功能需求 (Non-Functional)

| ID | 需求描述 | 优先级 | 备注 |
|----|----------|--------|------|
| NFR-1 | 定时任务与静态服务部署方式简单、可复现（如文档 + 标准 GitHub 配置） | Should | 便于他人复现或迁移 |
| NFR-2 | 静态页面在无登录场景下可本地或内网使用；若公网暴露需考虑只读与最小暴露 | Could | 安全与访问范围待确认 |
| NFR-3 | 数据与信号展示可维护：数据源、时间范围、指标定义与现有 ndx_rsi 一致 | Must | 与现有策略/报告一致 |
| NFR-4 | 项目保持现有 CLI（如 `run_signal`、`run_backtest`）可用，新功能不破坏现有命令 | Must | 回归兼容 |

### 2.3 约束与依赖

| ID | 说明 |
|----|------|
| C-1 | 参考项目 **daily_stock_analysis** 的定时执行与结果发送方式（该仓库可能不在当前 workspace，需单独查阅或由用户提供示例） |
| C-2 | 数据与指标逻辑以现有 **index_data_analysis** 实现为准（QQQ、EMA_trend_v2、run_signal 报告格式） |
| C-3 | 静态服务优先考虑“静态站点 + 预生成/定时生成的数据与报告”，避免强依赖实时后端（若需实时可后续迭代） |

---

## 3. 用户故事 (User Stories)

遵循 INVEST，按角色与价值编写。

### 3.1 每日信号触达

- **US-1**  
  **作为** 关注 QQQ 信号的用户，  
  **我希望** 每天在固定时间（如收盘后）自动跑一次信号并把结果发到我指定的渠道（邮件/群机器人等），  
  **以便** 不用每天手动登录机器执行命令也能收到当日结论。

- **US-2**  
  **作为** 项目维护者，  
  **我希望** 定时任务与发送渠道可通过配置或仓库配置（如 GitHub Actions + secrets）管理，  
  **以便** 不同环境或接收人可灵活调整而不改代码。

### 3.2 页面查看数据与信号

- **US-3**  
  **作为** 查看指数与信号的人，  
  **我希望** 在浏览器里打开一个页面就能看到 QQQ 最近 5 年的走势图，  
  **以便** 快速感知长期趋势而不必自己拉数据画图。

- **US-4**  
  **作为** 同一用户，  
  **我希望** 在同一页面（或关联页面）看到“当日”信号结果：收盘价、EMA、波动率、推导逻辑、操作建议等，  
  **以便** 把历史走势与当日结论一起看，决策更连贯。

- **US-5**  
  **作为** 维护者，  
  **我希望** 展示用的数据与报告来自当前项目已有的 `run_signal` / 数据管道，  
  **以便** 展示与 CLI 结果一致，避免两套逻辑。

---

## 4. 利益相关者与用户角色

| 角色 | 说明 | 主要诉求 |
|------|------|----------|
| 终端用户 / 自用 | 需要每日信号与历史走势查看 | 自动收结果、一页看全走势+当日信号 |
| 项目维护者 | 部署、配置、扩展 | 简单部署、可配置、不破坏现有 CLI |
| 参考项目 | daily_stock_analysis | 定时与推送的实践参考 |

---

## 5. 风险与待澄清项

| 类型 | 描述 | 状态 |
|------|------|------|
| 参考项目 | daily_stock_analysis 的定时与推送实现 | ✅ 已确认：路径 `daily_stock_analysis`，可参考其 GitHub Actions 与 Secrets（邮件/钉钉） |
| 渠道 | “相关渠道”首选 | ✅ 已确认：先支持邮件、钉钉 |
| 静态服务范围 | 本仓库静态站点 vs 独立站点 | ✅ 已确认：本仓库可启动的静态站点 |
| 数据更新 | 5 年走势与当日信号的更新频率 | ✅ 已确认：按建议（定时每日跑信号，静态页展示最近一次结果与 5 年数据） |

### 其他问题检查（复核结论）

- **路径**：您填写的相对路径为「.daily_stock_analysis」。当前 workspace 下实际目录名为 **`daily_stock_analysis`**（无前导点），已按实际路径写入上表；若您本地确为带点目录，以您本地为准即可。
- **参考实现**：已确认 `daily_stock_analysis` 存在，且包含 `.github/workflows/daily_analysis.yml`、邮件（EMAIL_*）与钉钉（CUSTOM_WEBHOOK_URLS）等配置方式，技术方案阶段可直接参考。
- **其余**：无新增阻塞项，需求可进入步骤 2「需求文档」。

**用户确认结果**（已记录）：

| 待澄清项 | 用户确认 |
|----------|----------|
| 参考项目路径 | daily_stock_analysis 在当前 workspace 下，**相对路径为 `daily_stock_analysis`**（与 index_data_analysis 同级，无前导点）。技术方案阶段可参考其 `.github/workflows/daily_analysis.yml` 及 Secrets（邮件：`EMAIL_*`，钉钉：`CUSTOM_WEBHOOK_URLS`） |
| 渠道 | 先支持 **邮件、钉钉** 两种 |
| 静态服务范围 | **本仓库可启动的静态站点** |
| 数据更新 | **按建议执行**：定时任务每日跑信号并产出结果；静态页展示最近一次结果与最近 5 年数据 |

---

## 6. 需求确认摘要

- **范围**：  
  - ① GitHub 部署 + 每日定时跑信号 + 结果发送到可配置渠道；  
  - ② 静态 Web 服务 + 5 年 QQQ 走势图 + 当日信号详情（收盘价、EMA、波动率、推导逻辑、操作建议等）。
- **不在此范围**（除非后续变更）：  
  - 实盘下单、多标的多策略配置界面、用户登录与权限、移动端 App。
- **与现有能力关系**：  
  - 复用现有 `run_signal`、数据获取与策略配置；新增定时调度、推送、静态站点与图表展示。



---

## 7. 输出物与检查点

| 输出物 | 状态 |
|--------|------|
| 需求清单（本节 2） | ✅ |
| 用户故事（本节 3） | ✅ |
| 需求确认文档（本节 5、6） | ✅ |
| 文件名 | `01-requirements_gathering.md`（本文档） |

**下一步**：请确认上述需求理解是否与 BRD 及您的预期一致；确认后进入步骤 2「需求文档」编写。  
若对优先级、渠道、或 daily_stock_analysis 参考方式有补充，请直接在本文档或 BRD 中注明。
