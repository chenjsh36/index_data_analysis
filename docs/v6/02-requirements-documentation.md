# 需求规格说明书（PRD/SRS）— v6

**文档类型**：需求文档（步骤 2）  
**依据**：`brd.md`、`01-requirements_gathering.md`  
**参考规范**：IEEE 830、ISO/IEC/IEEE 29148、PRD、FURPS+

---

## 1. 项目概述

### 1.1 背景

- 当前 **index_data_analysis** 已具备：QQQ 数据拉取、EMA 趋势策略回测、`run_signal` 生成可读报告（收盘价、EMA、波动率、推导逻辑、操作建议等）。
- 需求方希望：① 部署到 GitHub 后每日自动跑信号并将结果推送到指定渠道；② 通过浏览器访问静态页面查看 QQQ 近 5 年走势与当日信号，减少手工执行命令与查看数据的成本。

### 1.2 目标

- **自动化**：定时执行跑信号命令，并将结果发送至邮件、钉钉等可配置渠道。
- **可读性与集中展示**：在本仓库内提供静态 Web 服务，一页展示 5 年 QQQ 走势图与当日信号详情，与现有 CLI 输出一致。

### 1.3 范围

| 范围内 | 范围外（本期不做） |
|--------|-------------------|
| GitHub 部署 + 每日定时跑信号 | 实盘下单、交易执行 |
| 信号结果推送（邮件、钉钉） | 多标的多策略配置界面 |
| 本仓库静态站点 + 5 年 QQQ 走势图 + 当日信号展示 | 用户登录、权限、移动端 App |
| 复用现有 `run_signal`、数据与策略逻辑 | 实时后端 API（优先静态/预生成） |

### 1.4 UI 说明

本项目涉及 **Web 端静态页面**（走势图 + 信号结果展示）。在技术栈选择（步骤 3）中将判断并可采用设计系统（如工作区内的 **ui-ux-pro-max** skill）约束界面实现，保证视觉与交互一致性。

---

## 2. 功能需求

### 2.1 定时跑信号与推送

| ID | 功能描述 | 验收标准 |
|----|----------|----------|
| FR-1 | 项目部署到 GitHub 后，支持定时（如每天一次）自动执行“跑信号”命令 | 存在可运行的 GitHub Actions（或等价）工作流，在指定时间触发并成功执行本项目跑信号命令（如 `run_signal --symbol QQQ`） |
| FR-2 | 将每日信号运行结果发送到指定渠道 | 支持至少**邮件**、**钉钉**两种渠道；渠道通过配置（如 Secrets/环境变量）指定，无需改代码即可切换或同时使用 |
| FR-3 | 定时与渠道可配置 | 执行时间、标的（如 QQQ）、接收方（邮件收件人、钉钉 Webhook 等）可通过文档化方式配置 |

### 2.2 静态服务与页面展示

| ID | 功能描述 | 验收标准 |
|----|----------|----------|
| FR-4 | 在项目内启动静态 Web 服务，通过浏览器访问 | 提供明确方式（如命令或脚本）在本仓库内启动静态服务，本地或内网可通过 URL 访问页面 |
| FR-5 | 页面展示最近 5 年纳斯达克 QQQ 指数数据曲线走势图 | 页面加载后展示 QQQ 近 5 年（或可配置区间）的价格/指数曲线图；数据来源与现有项目数据管道一致或同源 |
| FR-6 | 页面展示当日运行信号后的结果 | 展示内容包含：收盘价、EMA、波动率、推导逻辑、操作建议等，与当前 `run_signal` 报告内容一致或为子集，且数据为“最近一次”跑信号的结果 |
| FR-7 | 静态页数据更新方式 | 数据由定时任务（与跑信号一致或关联）产出/更新，静态页展示“最近一次”结果与 5 年数据，无需实时后端接口（可后续迭代） |

### 2.3 可追溯性（与 01 需求清单对应）

| 本文档 ID | 01-requirements_gathering 对应 |
|-----------|--------------------------------|
| FR-1～FR-3 | FR-1, FR-2, FR-6 |
| FR-4～FR-7 | FR-3, FR-4, FR-5；用户确认「本仓库静态站点」「数据更新按建议」 |

---

## 3. 非功能需求

| ID | 类别 | 描述 | 验收标准 |
|----|------|------|----------|
| NFR-1 | 可维护性 | 部署与配置方式简单、可复现 | 提供文档说明如何在 GitHub 上配置定时任务与渠道；静态服务启动方式文档化 |
| NFR-2 | 兼容性 | 不破坏现有 CLI 与回测能力 | 现有 `run_signal`、`run_backtest`、`fetch_data` 等命令行为不变，测试可回归通过 |
| NFR-3 | 数据一致性 | 展示数据与现有 ndx_rsi 一致 | 走势图与信号展示使用的数据源、时间范围、指标定义与 `config` 及现有策略一致 |
| NFR-4 | 安全与访问 | 静态页只读、最小暴露 | 页面为只读展示；若公网暴露，无写操作与敏感配置暴露，访问范围在技术方案中约定 |

---

## 4. 约束条件

| ID | 约束类型 | 描述 |
|----|----------|------|
| C-1 | 参考实现 | 定时与推送实现参考同 workspace 下的 **daily_stock_analysis**（路径：`daily_stock_analysis`），可参考其 `.github/workflows/daily_analysis.yml` 及 Secrets（邮件：`EMAIL_*`，钉钉：`CUSTOM_WEBHOOK_URLS`） |
| C-2 | 数据与策略 | 数据与指标逻辑以现有 **index_data_analysis** 实现为准（QQQ、EMA_trend_v2、run_signal 报告格式） |
| C-3 | 架构 | 静态服务优先“静态站点 + 预生成/定时生成的数据与报告”，不强制要求实时后端 |

---

## 5. 验收标准（汇总）

- **定时与推送**：在 GitHub 上配置后，每日定时成功执行跑信号并将结果发送至至少一种渠道（邮件或钉钉）；渠道与时间可配置。
- **静态服务**：在本仓库内可启动静态服务，浏览器打开后可见 QQQ 近 5 年走势图与当日（最近一次）信号结果（含收盘价、EMA、波动率、推导逻辑、操作建议等）。
- **兼容与一致**：现有 CLI 与回测功能不受影响；展示数据与 `run_signal` 及项目配置一致。
- **文档**：提供部署与配置说明（定时任务、Secrets、静态服务启动）。

---

## 6. 术语表（Glossary）

| 术语 | 说明 |
|------|------|
| QQQ | 纳斯达克 100 指数 ETF，本项目中指代纳斯达克 100 相关指数/标的 |
| run_signal | 本项目 CLI 命令，拉取近期历史数据并输出最新一根 K 线的信号报告（收盘价、EMA、波动率、推导逻辑、操作建议等） |
| EMA_trend_v2 | 当前策略名称，80/200 日均线定趋势 + 20 日波动率过滤，配置见 `config/strategy.yaml` |
| daily_stock_analysis | 同 workspace 下的参考项目，提供 GitHub Actions 定时与多渠道推送（企业微信、飞书、Telegram、邮件、自定义 Webhook 等）的示例实现 |

---

## 7. 需求变更日志

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| v6 | 2025-02-13 | 初版：基于 brd.md 与 01-requirements_gathering 编写；渠道确认为邮件+钉钉，参考路径 daily_stock_analysis，静态站为本仓库、数据更新按建议 |

---

**下一步**：完成本步骤后需用户确认；确认后进入步骤 3「技术栈选择」。
